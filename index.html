<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Форма обратной связи</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
background-color: #f5f7fa;
color: #333;
line-height: 1.6;
padding: 20px;
}

.container {
max-width: 1200px;
margin: 0 auto;
padding: 20px;
}

header {
text-align: center;
margin-bottom: 40px;
}

h1 {
color: #2c3e50;
margin-bottom: 10px;
}

.description {
color: #7f8c8d;
max-width: 600px;
margin: 0 auto;
}

.btn-open {
background-color: #3498db;
color: white;
border: none;
padding: 12px 24px;
border-radius: 4px;
font-size: 16px;
cursor: pointer;
transition: background-color 0.3s;
box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.btn-open:hover {
background-color: #2980b9;
}

.overlay {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0, 0, 0, 0.5);
display: none;
justify-content: center;
align-items: center;
z-index: 1000;
padding: 20px;
}

.modal {
background-color: white;
border-radius: 8px;
box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
width: 100%;
max-width: 500px;
overflow: hidden;
animation: modalAppear 0.3s ease-out;
}

@keyframes modalAppear {
from {
opacity: 0;
transform: translateY(-20px);
}
to {
opacity: 1;
transform: translateY(0);
}
}

.modal-header {
background-color: #3498db;
color: white;
padding: 15px 20px;
display: flex;
justify-content: space-between;
align-items: center;
}

.modal-title {
font-size: 18px;
font-weight: 600;
}

.close-btn {
background: none;
border: none;
color: white;
font-size: 24px;
cursor: pointer;
line-height: 1;
}

.form-container {
padding: 20px;
}

.form-group {
margin-bottom: 15px;
}

label {
display: block;
margin-bottom: 5px;
font-weight: 500;
color: #2c3e50;
}

.required::after {
content: " *";
color: #e74c3c;
}

input, textarea {
width: 100%;
padding: 10px;
border: 1px solid #ddd;
border-radius: 4px;
font-size: 14px;
transition: border-color 0.3s;
}

input:focus, textarea:focus {
border-color: #3498db;
outline: none;
}

textarea {
min-height: 100px;
resize: vertical;
}

.error {
border-color: #e74c3c !important;
}

.error-message {
color: #e74c3c;
font-size: 12px;
margin-top: 5px;
display: none;
}

.checkbox-group {
display: flex;
align-items: flex-start;
margin-bottom: 20px;
}

.checkbox-group input {
width: auto;
margin-right: 10px;
margin-top: 3px;
}

.checkbox-group label {
font-weight: normal;
font-size: 14px;
}

.checkbox-group a {
color: #3498db;
text-decoration: none;
}

.checkbox-group a:hover {
text-decoration: underline;
}

.btn-submit {
background-color: #2ecc71;
color: white;
border: none;
padding: 12px 20px;
border-radius: 4px;
font-size: 16px;
cursor: pointer;
width: 100%;
transition: background-color 0.3s;
}

.btn-submit:hover {
background-color: #27ae60;
}

.btn-submit:disabled {
background-color: #95a5a6;
cursor: not-allowed;
}

.message {
padding: 15px;
border-radius: 4px;
margin-top: 15px;
text-align: center;
display: none;
}

.success {
background-color: #d4edda;
color: #155724;
border: 1px solid #c3e6cb;
}

.error-message-block {
background-color: #f8d7da;
color: #721c24;
border: 1px solid #f5c6cb;
}

@media (max-width: 480px) {
.modal {
max-width: 100%;
height: 100%;
border-radius: 0;
}

.form-container {
padding: 15px;
}
}
</style>
</head>
<body>
<div class="container">
<header>
<h1>Форма обратной связи</h1>
<p class="description">Нажмите на кнопку ниже, чтобы открыть форму обратной связи. Форма адаптирована для всех устройств и сохраняет ваши данные локально.</p>
<button class="btn-open" id="openModalBtn">Открыть форму</button>
</header>

<main>
<p>Это демонстрационная страница для формы обратной связи. Форма откроется в модальном окне поверх страницы при клике на кнопку выше.</p>
</main>
</div>

<div class="overlay" id="overlay">
<div class="modal">
<div class="modal-header">
<h2 class="modal-title">Форма обратной связи</h2>
<button class="close-btn" id="closeModalBtn">&times;</button>
</div>
<div class="form-container">
<form id="feedbackForm">
<div class="form-group">
<label for="fullName" class="required">ФИО</label>
<input type="text" id="fullName" name="fullName" required>
<div class="error-message" id="fullNameError">ФИО не должно содержать цифр</div>
</div>

<div class="form-group">
<label for="email" class="required">Email</label>
<input type="email" id="email" name="email" required>
<div class="error-message" id="emailError">Введите корректный email адрес</div>
</div>

<div class="form-group">
<label for="phone" class="required">Телефон</label>
<input type="tel" id="phone" name="phone" required>
<div class="error-message" id="phoneError">Телефон должен содержать только цифры и знак +</div>
</div>

<div class="form-group">
<label for="organization" class="required">Организация</label>
<input type="text" id="organization" name="organization" required>
<div class="error-message" id="organizationError">Поле обязательно для заполнения</div>
</div>

<div class="form-group">
<label for="message" class="required">Сообщение</label>
<textarea id="message" name="message" required></textarea>
<div class="error-message" id="messageError">Поле обязательно для заполнения</div>
</div>

<div class="checkbox-group">
<input type="checkbox" id="consent" name="consent" required>
<label for="consent" class="required">Я согласен с <a href="#" target="_blank">политикой обработки персональных данных</a></label>
</div>
<div class="error-message" id="consentError">Необходимо ваше согласие</div>

<button type="submit" class="btn-submit" id="submitBtn">Отправить</button>

<div class="message success" id="successMessage">
Сообщение успешно отправлено!
</div>

<div class="message error-message-block" id="errorMessage">
Произошла ошибка при отправке. Пожалуйста, попробуйте позже.
</div>
</form>
</div>
</div>
</div>

<script>
// Элементы DOM
const openModalBtn = document.getElementById('openModalBtn');
const closeModalBtn = document.getElementById('closeModalBtn');
const overlay = document.getElementById('overlay');
const feedbackForm = document.getElementById('feedbackForm');
const submitBtn = document.getElementById('submitBtn');
const successMessage = document.getElementById('successMessage');
const errorMessage = document.getElementById('errorMessage');

// Элементы для ошибок
const fullNameError = document.getElementById('fullNameError');
const emailError = document.getElementById('emailError');
const phoneError = document.getElementById('phoneError');
const organizationError = document.getElementById('organizationError');
const messageError = document.getElementById('messageError');
const consentError = document.getElementById('consentError');

// Ключ для localStorage
const STORAGE_KEY = 'feedbackFormData';

// Открытие модального окна
openModalBtn.addEventListener('click', () => {
overlay.style.display = 'flex';
document.body.style.overflow = 'hidden';

// Изменение URL с помощью History API
history.pushState({ modalOpen: true }, '', '#feedback');

// Восстановление данных из localStorage
restoreFormData();
});

// Закрытие модального окна
function closeModal() {
overlay.style.display = 'none';
document.body.style.overflow = 'auto';

// Возврат к исходному URL
history.back();
}

closeModalBtn.addEventListener('click', closeModal);

// Закрытие по клику вне формы
overlay.addEventListener('click', (e) => {
if (e.target === overlay) {
closeModal();
}
});

// Обработка нажатия кнопки "Назад" в браузере
window.addEventListener('popstate', (e) => {
if (overlay.style.display === 'flex') {
closeModal();
}
});

// Сохранение данных формы в localStorage
function saveFormData() {
const formData = {
fullName: document.getElementById('fullName').value,
email: document.getElementById('email').value,
phone: document.getElementById('phone').value,
organization: document.getElementById('organization').value,
message: document.getElementById('message').value,
consent: document.getElementById('consent').checked
};

localStorage.setItem(STORAGE_KEY, JSON.stringify(formData));
}

// Восстановление данных формы из localStorage
function restoreFormData() {
const savedData = localStorage.getItem(STORAGE_KEY);

if (savedData) {
const formData = JSON.parse(savedData);

document.getElementById('fullName').value = formData.fullName || '';
document.getElementById('email').value = formData.email || '';
document.getElementById('phone').value = formData.phone || '';
document.getElementById('organization').value = formData.organization || '';
document.getElementById('message').value = formData.message || '';
document.getElementById('consent').checked = formData.consent || false;
}
}

// Очистка данных формы в localStorage
function clearFormData() {
localStorage.removeItem(STORAGE_KEY);
}

// Валидация формы
function validateForm() {
let isValid = true;

// Сброс ошибок
resetErrors();

// Проверка ФИО
const fullName = document.getElementById('fullName').value;
if (!fullName) {
showError('fullName', 'Поле обязательно для заполнения');
isValid = false;
} else if (/\d/.test(fullName)) {
showError('fullName', 'ФИО не должно содержать цифр');
isValid = false;
}

// Проверка email
const email = document.getElementById('email').value;
if (!email) {
showError('email', 'Поле обязательно для заполнения');
isValid = false;
} else if (!email.includes('@')) {
showError('email', 'Введите корректный email адрес');
isValid = false;
}

// Проверка телефона
const phone = document.getElementById('phone').value;
if (!phone) {
showError('phone', 'Поле обязательно для заполнения');
isValid = false;
} else if (!/^[\d+]+$/.test(phone)) {
showError('phone', 'Телефон должен содержать только цифры и знак +');
isValid = false;
}

// Проверка организации
const organization = document.getElementById('organization').value;
if (!organization) {
showError('organization', 'Поле обязательно для заполнения');
isValid = false;
}

// Проверка сообщения
const message = document.getElementById('message').value;
if (!message) {
showError('message', 'Поле обязательно для заполнения');
isValid = false;
}

// Проверка согласия
const consent = document.getElementById('consent').checked;
if (!consent) {
showError('consent', 'Необходимо ваше согласие');
isValid = false;
}

return isValid;
}

// Показать ошибку
function showError(fieldName, message) {
const field = document.getElementById(fieldName);
const errorElement = document.getElementById(fieldName + 'Error');

field.classList.add('error');
errorElement.textContent = message;
errorElement.style.display = 'block';
}

// Сброс ошибок
function resetErrors() {
const errorElements = document.querySelectorAll('.error-message');
errorElements.forEach(element => {
element.style.display = 'none';
});

const fields = document.querySelectorAll('input, textarea');
fields.forEach(field => {
field.classList.remove('error');
});
}

// Обработка отправки формы
feedbackForm.addEventListener('submit', async (e) => {
e.preventDefault();

// Валидация формы
if (!validateForm()) {
return;
}

// Показать индикатор загрузки
submitBtn.disabled = true;
submitBtn.textContent = 'Отправка...';

// Скрыть предыдущие сообщения
successMessage.style.display = 'none';
errorMessage.style.display = 'none';

// Сбор данных формы
const formData = new FormData(feedbackForm);
const data = {
fullName: formData.get('fullName'),
email: formData.get('email'),
phone: formData.get('phone'),
organization: formData.get('organization'),
message: formData.get('message'),
consent: formData.get('consent') === 'on'
};

try {
// Отправка данных на сервер (используем Formspree в качестве примера)
// Замените URL на ваш собственный из formcarry.com или slapform.com
const response = await fetch('https://formspree.io/f/xjvnqjqa', {
method: 'POST',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify(data),
});

if (response.ok) {
// Успешная отправка
successMessage.style.display = 'block';
feedbackForm.reset();
clearFormData();
resetErrors();
} else {
throw new Error('Ошибка сервера');
}
} catch (error) {
// Ошибка отправки
console.error('Ошибка:', error);
errorMessage.style.display = 'block';
} finally {
// Восстановить кнопку отправки
submitBtn.disabled = false;
submitBtn.textContent = 'Отправить';
}
});

// Сохранение данных формы при изменении
feedbackForm.addEventListener('input', saveFormData);
feedbackForm.addEventListener('change', saveFormData);

// Валидация в реальном времени
document.getElementById('fullName').addEventListener('blur', () => {
const fullName = document.getElementById('fullName').value;
if (fullName && /\d/.test(fullName)) {
showError('fullName', 'ФИО не должно содержать цифр');
} else {
resetFieldError('fullName');
}
});

document.getElementById('email').addEventListener('blur', () => {
const email = document.getElementById('email').value;
if (email && !email.includes('@')) {
showError('email', 'Введите корректный email адрес');
} else {
resetFieldError('email');
}
});

document.getElementById('phone').addEventListener('blur', () => {
const phone = document.getElementById('phone').value;
if (phone && !/^[\d+]+$/.test(phone)) {
showError('phone', 'Телефон должен содержать только цифры и знак +');
} else {
resetFieldError('phone');
}
});

// Сброс ошибки для конкретного поля
function resetFieldError(fieldName) {
const field = document.getElementById(fieldName);
const errorElement = document.getElementById(fieldName + 'Error');

field.classList.remove('error');
errorElement.style.display = 'none';
}
</script>
</body>
</html>